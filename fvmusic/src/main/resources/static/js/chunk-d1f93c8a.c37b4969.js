(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d1f93c8a"],{"380c":function(e,a,s){"use strict";var t=s("a97b"),o=s.n(t);o.a},4934:function(e,a,s){"use strict";s.r(a);var t=function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("div",{staticClass:"main_wrapper"},[s("div",{staticClass:"edit_wrapper"},[s("div",{staticClass:"avatar_upload_wrapper"},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击上传新的头像吧",placement:"top"}},[s("div",{staticClass:"avatar_container"},[s("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.ossUploadUrl,data:e.dataObj,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.userInfoComputed.avatarUrl?s("img",{staticClass:"avatar",attrs:{src:e.userInfoComputed.avatarUrl}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)])],1),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"edit_basic_info",attrs:{"element-loading-text":"更新中....","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[s("el-form",{ref:"userInfo",attrs:{model:e.userInfo,rules:e.basicInfoRules}},[s("el-form-item",{attrs:{prop:"username"}},[s("label",{attrs:{for:"username"}},[e._v("用户名")]),s("el-input",{attrs:{id:"username",autocomplete:"off"},model:{value:e.userInfoComputed.username,callback:function(a){e.$set(e.userInfoComputed,"username",a)},expression:"userInfoComputed.username"}})],1),s("el-form-item",{attrs:{prop:"qq"}},[s("label",{attrs:{for:"qq"}},[e._v("公开我的qq")]),s("el-input",{attrs:{id:"qq",autocomplete:"off"},model:{value:e.userInfoComputed.qq,callback:function(a){e.$set(e.userInfoComputed,"qq",e._n(a))},expression:"userInfoComputed.qq"}})],1),s("el-form-item",[s("label",{attrs:{for:"skill"}},[e._v("一技之长，guitar?")]),s("el-input",{attrs:{id:"skill",autocomplete:"off"},model:{value:e.userInfoComputed.skill,callback:function(a){e.$set(e.userInfoComputed,"skill",a)},expression:"userInfoComputed.skill"}})],1),s("el-form-item",[s("label",{attrs:{for:"profession"}},[e._v("我从事于，enjoy coding ?")]),s("el-input",{attrs:{id:"profession",autocomplete:"off"},model:{value:e.userInfoComputed.profession,callback:function(a){e.$set(e.userInfoComputed,"profession",a)},expression:"userInfoComputed.profession"}})],1),s("el-form-item",{attrs:{prop:"age",rules:[{type:"number",message:"年龄必须为数字值"}]}},[s("label",{attrs:{for:"age"}},[e._v("是否告诉别人自己的年龄？")]),s("el-input",{attrs:{id:"age",type:"age",autocomplete:"off"},model:{value:e.userInfoComputed.age,callback:function(a){e.$set(e.userInfoComputed,"age",e._n(a))},expression:"userInfoComputed.age"}})],1),s("div",{staticStyle:{"margin-top":"50px","text-align":"center",height:"40px",width:"300px"}},[s("el-button",{attrs:{type:"primary",plain:""},on:{click:e.submitUpdate}},[e._v("更新")])],1)],1),s("div",{staticClass:"account_safe_setting"},[s("div",{staticClass:"button_wrapper"},[s("el-button",{attrs:{type:"warning",plain:""},on:{click:function(a){e.dialogFormVisible=!0}}},[e._v("修改密码")]),s("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){e.dialogFormVisible2=!0}}},[e._v("上传主页背景")])],1),s("el-dialog",{attrs:{title:"修改密码",visible:e.dialogFormVisible},on:{"update:visible":function(a){e.dialogFormVisible=a}}},[s("div",{staticClass:"update_pass_dig",attrs:{slot:"footer"},slot:"footer"},[s("el-form",{ref:"updatePassword",staticClass:"demo-ruleForm",attrs:{model:e.updatePassword,"status-icon":"",rules:e.UpdatePasswordRules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"原密码",prop:"oldPassword"}},[s("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.updatePassword.oldPassword,callback:function(a){e.$set(e.updatePassword,"oldPassword",a)},expression:"updatePassword.oldPassword"}})],1),s("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[s("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.updatePassword.newPassword,callback:function(a){e.$set(e.updatePassword,"newPassword",a)},expression:"updatePassword.newPassword"}})],1),s("el-form-item",{attrs:{label:"确认密码",prop:"repeatPassword"}},[s("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.updatePassword.repeatPassword,callback:function(a){e.$set(e.updatePassword,"repeatPassword",a)},expression:"updatePassword.repeatPassword"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:e.submitUpdatePassword}},[e._v("提交")])],1)],1),s("div",{staticClass:"dig_op_btn"},[s("el-button",{attrs:{type:"primary"},on:{click:function(a){e.dialogFormVisible=!1}}},[e._v("关 闭")])],1)],1)]),s("el-dialog",{attrs:{title:"上传主页背景",visible:e.dialogFormVisible2},on:{"update:visible":function(a){e.dialogFormVisible2=a}}},[s("div",{staticClass:"upload_container"},[s("UploadPhoto",{on:{sendUrl:function(a){return e.updateUrl(a)}}})],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(a){e.dialogFormVisible2=!1}}},[e._v("完 成")])],1)])],1)],1)])])},o=[],r=(s("d3b7"),s("ac1f"),s("5319"),s("61f7")),n=s("7d9b"),i=s("0e5c"),d=s("ba82"),l=s("5f87"),u={name:"EditUserInfo",components:{UploadPhoto:d["a"]},data:function(){var e=this,a=function(a,s,t){e.updatePassword.newPassword=e.updatePassword.newPassword.replace(" ",""),s=e.updatePassword.newPassword,""===s?t(new Error("不能为空")):Object(r["d"])(s)?t(new Error("密码只能是6-20位的字母加数字组合")):s===e.updatePassword.oldPassword?t(new Error("新密码与旧密码一致")):t()},s=function(a,s,t){e.updatePassword.repeatPassword=e.updatePassword.repeatPassword.replace(" ",""),s=e.updatePassword.repeatPassword,s!==e.updatePassword.newPassword?t(new Error("两次密码输入不一致，请重新输入")):t()};return{loading:!1,ossUploadUrl:"http://fv-music.oss-cn-shanghai.aliyuncs.com",dataObj:{policy:"",signature:"",key:"",ossaccessKeyId:"",dir:"",host:""},dialogFormVisible:!1,dialogFormVisible2:!1,updatePassword:{oldPassword:"",newPassword:"",repeatPassword:"",username:""},UpdatePasswordRules:{oldPassword:[{required:!0,message:"不能为空",trigger:"blur"}],newPassword:[{validator:a,trigger:"blur"}],repeatPassword:[{validator:s,trigger:"blur"}]},basicInfoRules:{username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{max:15,message:"最长只能15个字哦",trigger:"blur"}],qq:[{type:"number",message:"年龄只能是数字",trigger:"blur"}]},userInfo:{id:"",username:"",qq:"",skill:"",profession:"",age:"",avatarUrl:"",email:"",backgroundUrl:""},avatarFilename:""}},methods:{handleAvatarSuccess:function(e,a){var s=this;console.log(e),console.log(a);var t=Object(i["b"])(this.avatarFilename);n["a"].commonUrlEncodingPost("/userInfo/updateAvatar",{uId:this.userInfo.id,avatarUrl:t}).then((function(e){console.log(e),200===e.data.code?(s.$message.success("头像上传成功"),s.userInfo.avatarUrl=t):s.$message.error(e.data.message)}))},beforeAvatarUpload:function(e){var a=this,s="image/jpeg"===e.type,t=e.size/1024/1024<2;return s||this.$message.error("上传头像图片只能是 JPG 格式!"),t||this.$message.error("上传头像图片大小不能超过 2MB!"),this.avatarFilename=Object(i["a"])(this.userInfo.id,e.type,e.uid),new Promise((function(e,s){n["a"].get("/aliyun/oss/policy").then((function(s){console.log(s),a.dataObj.policy=s.data.data.policy,a.dataObj.signature=s.data.data.signature,a.dataObj.ossaccessKeyId=s.data.data.accessKeyId,a.dataObj.key=s.data.data.dir+"/"+a.avatarFilename,a.dataObj.dir=s.data.data.dir,a.dataObj.host=s.data.data.host,e(!0)})).catch((function(e){console.log(e),s(!1)}))}))},submitUpdate:function(){var e=this;this.$refs.userInfo.validate((function(a){if(!a)return!1;e.loading=!0;var s={id:e.userInfo.id,username:e.userInfo.username,email:e.userInfo.email,skill:e.userInfo.skill,profession:e.userInfo.profession,age:e.userInfo.age,qq:e.userInfo.qq};n["a"].commonJsonPost("/userInfo/update",s).then((function(a){console.log(a),200===a.data.code?(e.$message.success("更新成功"),e.userInfo=a.data.data,e.$store.commit("setUserInfo",a.data.data),e.loading=!1):e.$message.info("更新失败")})).catch((function(e){console.log(e.message)}))}))},submitUpdatePassword:function(){var e=this;this.$refs.updatePassword.validate((function(a){if(!a)return!1;var s={newPassword:e.updatePassword.newPassword,oldPassword:e.updatePassword.oldPassword,uid:e.userInfo.id};n["a"].commonJsonPost("/updatePassword",s).then((function(a){console.log(a),200===a.data.code?(e.$message.success("密码修改成功请重新登录"),e.$router.push("/login"),Object(l["b"])(),e.$message.commit("setIsLogin",!1)):e.$message.warning(a.data.message)})).catch((function(a){e.$message.error(a.message)}))}))},updateUrl:function(e){var a=this;n["a"].commonUrlEncodingPost("/userInfo/uploadBackground",{url:e,uid:this.userInfo.id,username:this.userInfo.username,email:this.userInfo.email}).then((function(e){200===e.data.code?a.$message.success("上传成功"):a.$message.warning("上传失败")})).catch((function(e){a.$message.error("连接不上服务器，请检查网络")}))}},mounted:function(){this.$store.getters.userInfo&&(this.userInfo=this.$store.getters.userInfo)},computed:{userInfoComputed:function(){return this.userInfo}}},c=u,p=(s("380c"),s("2877")),f=Object(p["a"])(c,t,o,!1,null,"35789614",null);a["default"]=f.exports},"61f7":function(e,a,s){"use strict";s.d(a,"a",(function(){return t})),s.d(a,"c",(function(){return o})),s.d(a,"d",(function(){return r})),s.d(a,"b",(function(){return n}));s("4d63"),s("ac1f"),s("25f0"),s("5319");function t(e){for(var a=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）&;—|{ }【】‘；：”“'。，、？]"),s="",t=0;t<e.length;t++)s+=e.substr(t,1).replace(a,"");return s}function o(e){var a=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;return!a.test(e)}function r(e){var a=/^(?!\D+$)(?![^a-zA-Z]+$)\S{6,20}$/;return!a.test(e)}function n(e){var a=/^[A-Za-z0-9]{6}$/;return!a.test(e)}},a97b:function(e,a,s){}}]);